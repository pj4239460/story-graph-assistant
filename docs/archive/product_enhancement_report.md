# äº§å“ä½“éªŒæ”¹è¿›å®æ–½æŠ¥å‘Š

## âœ… å·²å®Œæˆï¼šæ ¸å¿ƒ3é¡¹æ”¹è¿›

### 1. ğŸ“š ç¤ºä¾‹é¡¹ç›®ä¸€é”®æ‰“å¼€

**ä½ç½®:** [sidebar.py#L21-L42](../src/ui/sidebar.py)

**å®ç°:**
- åœ¨ä¾§è¾¹æ é¡¹ç›®æ“ä½œåŒºæ·»åŠ ç¬¬3ä¸ªæŒ‰é’®ï¼š"ğŸ“š Sample"
- ç‚¹å‡»åè‡ªåŠ¨åŠ è½½ `examples/sample_project/project.json`
- è‡ªåŠ¨æ·»åŠ åˆ°æœ€è¿‘é¡¹ç›®åˆ—è¡¨
- å‹å¥½çš„æˆåŠŸ/å¤±è´¥æç¤º

**ç”¨æˆ·ä½“éªŒ:**
```
æ–°ç”¨æˆ·æ‰“å¼€åº”ç”¨ â†’ çœ‹åˆ° "Sample" æŒ‰é’® â†’ ç‚¹å‡» â†’ ç«‹å³çœ‹åˆ°å®Œæ•´ç¤ºä¾‹é¡¹ç›®
æ— éœ€ç†è§£ JSON æ ¼å¼ï¼Œæ— éœ€é…ç½®ï¼Œç›´æ¥ä½“éªŒåŠŸèƒ½
```

**ä»£ç äº®ç‚¹:**
```python
if st.button("ğŸ“š Sample", help="Open example project / æ‰“å¼€ç¤ºä¾‹é¡¹ç›®"):
    sample_path = os.path.abspath("./examples/sample_project/project.json")
    project_service.load_project(sample_path)
    app_db.add_recent_project(sample_path, "Sample Project")
```

---

### 2. ğŸ”¬ åœºæ™¯ä½“æ£€é¢æ¿ (Scene Checkup Panel)

**ä½ç½®:** [scene_checkup_panel.py](../src/ui/scene_checkup_panel.py)

**æ ¸å¿ƒç‰¹æ€§:**

#### ğŸ“¦ æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿ
- åŸºäº `project_name + scene_id + scene_body_hash` ç”Ÿæˆç¼“å­˜é”®
- é¿å…é‡å¤åˆ†æç›¸åŒåœºæ™¯ï¼ˆèŠ‚çœ token å’Œæ—¶é—´ï¼‰
- æ”¯æŒå¼ºåˆ¶åˆ·æ–°ï¼ˆ"ğŸ”„ Refresh" æŒ‰é’®ï¼‰

#### ğŸ” ç»“æ„åŒ–åˆ†æè¾“å‡º
```python
{
    "summary": "AI ç”Ÿæˆçš„åœºæ™¯æ‘˜è¦",
    "facts": ["è®¾å®š1", "è®¾å®š2", "ä¼ç¬”3"],
    "ooc_risk": {"level": "low|medium|high", "details": "..."},
    "emotions": ["joy", "surprise"],
    "metadata": {...},
    "timestamp": "2025-12-30T...",
    "cached": false
}
```

#### ğŸ¨ UI å¸ƒå±€
- **4ä¸ªå¯æŠ˜å åŒºåŸŸ:**
  1. ğŸ“ Summary ï¼ˆé»˜è®¤å±•å¼€ï¼‰
  2. ğŸŒ Extracted Facts & Plot Points ï¼ˆé»˜è®¤å±•å¼€ï¼‰
  3. âš ï¸ OOC Risk Assessment ï¼ˆæŠ˜å ï¼Œé¢„ç•™åŠŸèƒ½ï¼‰
  4. ğŸ“Š Scene Metadata ï¼ˆæŠ˜å ï¼‰

- **æƒ…ç»ªå¯è§†åŒ–:**
  - ğŸ˜Š Joy / ğŸ˜¢ Sadness / ğŸ˜  Anger / ğŸ˜¨ Fear / ğŸ˜® Surprise / ğŸ˜ Neutral
  - åŸºäºç®€å•å…³é”®è¯å¯å‘å¼æ£€æµ‹ï¼ˆå¯å‡çº§ä¸º AI åˆ†æï¼‰

- **å¯¼å‡ºåŠŸèƒ½:**
  - ğŸ’¾ Export Report â†’ ä¸‹è½½ JSON æ ¼å¼å®Œæ•´æŠ¥å‘Š
  - å¯ç”¨ä½œé¡¹ç›®æ–‡æ¡£æˆ– Story Bible é™„ä»¶

#### ğŸ”— é›†æˆæ–¹å¼
åœ¨å›¾è°±è§†å›¾ç‚¹å‡»èŠ‚ç‚¹ â†’ å¼¹å‡ºåœºæ™¯è¯¦æƒ… â†’ **3ä¸ª Tab:**
1. ğŸ“ Content - æŸ¥çœ‹å†…å®¹å’Œé€‰é¡¹
2. ğŸ”¬ **AI Checkup** - ä¸€é”®ä½“æ£€
3. âš™ï¸ Metadata - æŠ€æœ¯ä¿¡æ¯

**ä»£ç æ¶æ„:**
```python
class SceneCheckup:
    def run_checkup(project, scene, force_refresh=False):
        # æ£€æŸ¥ç¼“å­˜
        if cached and not force_refresh:
            return cached_result
        
        # è°ƒç”¨ AI æœåŠ¡
        summary = ai_service.summarize_scene(project, scene)
        facts = ai_service.extract_facts(project, scene)
        # ooc = ai_service.check_ooc(project, scene)  # é¢„ç•™
        
        # ç¼“å­˜ç»“æœ
        cache[key] = result
        return result
```

---

### 3. ğŸ–±ï¸ èŠ‚ç‚¹ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…

**ä½ç½®:** [routes_view.py#L467-L514](../src/ui/routes_view.py)

**å®ç°:**
- å¯ç”¨ `get_node_on_click=True` å‚æ•°
- ç›‘å¬ `flow_state.selected_id`
- åœ¨å›¾è°±ä¸‹æ–¹æ˜¾ç¤ºåœºæ™¯è¯¦æƒ… expander
- é›†æˆåœºæ™¯ä½“æ£€é¢æ¿ä½œä¸ºé€‰é¡¹å¡

**äº¤äº’æµç¨‹:**
```
ç”¨æˆ·ç‚¹å‡»å›¾è°±ä¸­çš„èŠ‚ç‚¹
  â†“
selected_scene_id ä¿å­˜åˆ° session_state
  â†“
æ˜¾ç¤º expander åŒ…å«3ä¸ª tabs
  â”œâ”€ Content: æ ‡é¢˜ã€ç« èŠ‚ã€æ­£æ–‡ã€é€‰é¡¹
  â”œâ”€ AI Checkup: åœºæ™¯ä½“æ£€é¢æ¿ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
  â””â”€ Metadata: JSON æŠ€æœ¯ä¿¡æ¯
  â†“
ç‚¹å‡» "âœ– Close" å…³é—­è¯¦æƒ…
```

**æç¤ºæ–‡æœ¬æ›´æ–°:**
- è‹±æ–‡: "Right-click nodes for edit/delete options | **Click nodes to view details**"
- ä¸­æ–‡: "å³é”®ç‚¹å‡»èŠ‚ç‚¹è¿›è¡Œç¼–è¾‘/åˆ é™¤æ“ä½œ | **å•å‡»æŸ¥çœ‹è¯¦æƒ…**"

---

## ğŸ¯ å¯¹æ¯”ï¼šæ”¹è¿›å‰ vs æ”¹è¿›å

### æ–°ç”¨æˆ·ä¸Šæ‰‹ä½“éªŒ

**ä¹‹å‰:**
```
1. æ‰“å¼€åº”ç”¨ â†’ ç©ºç™½é¡¹ç›®
2. é˜…è¯»æ–‡æ¡£å­¦ä¹  JSON æ ¼å¼
3. æ‰‹åŠ¨åˆ›å»ºé¡¹ç›®æˆ–åŠ è½½æ–‡ä»¶
4. ä¸ç¡®å®šåŠŸèƒ½æ˜¯ä»€ä¹ˆæ ·çš„
```

**ç°åœ¨:**
```
1. æ‰“å¼€åº”ç”¨ â†’ çœ‹åˆ° "Sample" æŒ‰é’®
2. ç‚¹å‡» â†’ ç«‹å³çœ‹åˆ°å®Œæ•´çš„èµ›åšä¾¦æ¢ç¤ºä¾‹
3. åœ¨çœŸå®é¡¹ç›®ä¸­æ¢ç´¢æ‰€æœ‰åŠŸèƒ½
4. ç«‹å³ç†è§£å·¥å…·çš„ä»·å€¼
```

### AI åˆ†æå·¥ä½œæµ

**ä¹‹å‰:**
```
1. å» AI å·¥å…·é¡µé¢
2. ç‚¹å‡»"åœºæ™¯æ‘˜è¦" â†’ ç­‰å¾…
3. å†ç‚¹å‡»"è®¾å®šæå–" â†’ ç­‰å¾…
4. ç»“æœåˆ†æ•£ï¼Œéš¾ä»¥æ•´ä½“æŠŠæ¡
5. æ¯æ¬¡é‡æ–°æŸ¥çœ‹éƒ½è¦é‡æ–°ç”Ÿæˆï¼ˆæµªè´¹ tokenï¼‰
```

**ç°åœ¨:**
```
1. å›¾è°±ä¸­ç‚¹å‡»åœºæ™¯èŠ‚ç‚¹
2. åˆ‡æ¢åˆ° "AI Checkup" æ ‡ç­¾
3. çœ‹åˆ°å®Œæ•´çš„ç»“æ„åŒ–æŠ¥å‘Šï¼ˆæœ‰ç¼“å­˜ï¼‰
4. ä¸€çœ¼çœ‹åˆ°æ‘˜è¦ã€è®¾å®šã€æƒ…ç»ªã€å…ƒæ•°æ®
5. å¯ä»¥å¯¼å‡ºæŠ¥å‘Šç”¨äºæ–‡æ¡£
```

### åœºæ™¯æŸ¥çœ‹ä½“éªŒ

**ä¹‹å‰:**
```
å›¾è°±åªèƒ½çœ‹ç»“æ„
æƒ³äº†è§£åœºæ™¯å†…å®¹ â†’ å»åœºæ™¯åˆ—è¡¨ â†’ ä¸ç›´è§‚
```

**ç°åœ¨:**
```
å›¾è°±ä¸­ç‚¹å‡»èŠ‚ç‚¹ â†’ ç«‹å³çœ‹åˆ°å†…å®¹å’Œåˆ†æ
ç›´è§‚ã€å¿«é€Ÿã€æ— éœ€åˆ‡æ¢é¡µé¢
```

---

## ğŸ“Š æŠ€æœ¯äº®ç‚¹

### 1. ç¼“å­˜ç­–ç•¥
```python
def get_cache_key(project, scene):
    scene_hash = hash(scene.body)  # å†…å®¹å˜åŒ–æ‰å¤±æ•ˆ
    return f"{project.name}_{scene.id}_{scene_hash}"
```
- åªæœ‰åœºæ™¯å†…å®¹çœŸæ­£æ”¹å˜æ‰é‡æ–°åˆ†æ
- èŠ‚çœ API è°ƒç”¨å’Œå“åº”æ—¶é—´
- session_state çº§åˆ«ç¼“å­˜ï¼ˆé‡å¯åº”ç”¨ä¼šæ¸…é™¤ï¼‰

### 2. æ¨¡å—åŒ–è®¾è®¡
- `SceneCheckup` ç±»å®Œå…¨ç‹¬ç«‹
- å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨ `render_scene_checkup_tab()`
- æ˜“äºæµ‹è¯•å’Œç»´æŠ¤

### 3. æ¸è¿›å¢å¼º
- OOC æ£€æµ‹é¢„ç•™æ¥å£ï¼ŒAI Service å®ç°åå¯æ— ç¼é›†æˆ
- æƒ…ç»ªæ£€æµ‹å½“å‰æ˜¯å¯å‘å¼ï¼Œå¯å‡çº§ä¸º AI åˆ†æ
- å¯¼å‡ºåŠŸèƒ½å·²å®ç°ï¼Œæœªæ¥å¯æ‰©å±•ä¸ºå¤šæ ¼å¼ï¼ˆMarkdownã€CSVï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®ï¼ˆä¼˜å…ˆçº§æ’åºï¼‰

### é«˜ä¼˜å…ˆçº§ï¼ˆå®Œæˆ3ä»¶äº‹ä¸­çš„æœ€å1ä»¶ï¼‰

#### 3. è·¯å¾„è¯•ç© (Play Path) - åŸºç¡€ç‰ˆ
**ç›®æ ‡:** è®©ç”¨æˆ·èƒ½ä»èµ·ç‚¹ä¸€è·¯èµ°åˆ°ç»ˆç‚¹

**æœ€å°å®ç°:**
```python
# æ–°æ–‡ä»¶: src/ui/play_path_view.py

class PathPlayer:
    def __init__(self, project, start_scene_id):
        self.path_history = [start_scene_id]  # èµ°è¿‡çš„è·¯å¾„
        self.current_scene_id = start_scene_id
    
    def render_player_panel(self):
        # æ˜¾ç¤ºå½“å‰åœºæ™¯
        scene = project.scenes[self.current_scene_id]
        st.markdown(f"## {scene.title}")
        st.write(scene.body or scene.summary)
        
        # æ˜¾ç¤ºé€‰é¡¹æŒ‰é’®
        for choice in scene.choices:
            if st.button(choice.text):
                self.path_history.append(choice.nextSceneId)
                self.current_scene_id = choice.nextSceneId
                st.rerun()
        
        # è·¯å¾„å†å²
        with st.expander("ğŸ“œ Path History"):
            for i, sid in enumerate(self.path_history, 1):
                st.caption(f"{i}. {project.scenes[sid].title}")
```

**é›†æˆä½ç½®:**
- åœ¨å›¾è°±è§†å›¾å³é”®èœå•æ·»åŠ  "â–¶ Start from here"
- æˆ–åœ¨åœºæ™¯è¯¦æƒ…æ·»åŠ  "â–¶ Play from here" æŒ‰é’®
- å¼¹å‡ºä¾§è¾¹æ  / æ–°é¡µé¢æ˜¾ç¤ºæ’­æ”¾å™¨

**ä»·å€¼:**
- ä½œè€…å¯ä»¥æµ‹è¯•ç©å®¶ä½“éªŒ
- å¿«é€ŸéªŒè¯åˆ†æ”¯é€»è¾‘
- å¯¼å‡ºè·¯å¾„è®°å½•ç”¨äºæµ‹è¯•æŠ¥å‘Š

---

### ä¸­ä¼˜å…ˆçº§ï¼ˆé”¦ä¸Šæ·»èŠ±ï¼‰

#### 4. æ–°æ‰‹å¼•å¯¼æç¤ºæ¡
åœ¨é¦–é¡µå³ä¾§æ·»åŠ ï¼š
```markdown
## ğŸ“ Quick Start Guide

1. âœ… Open Sample Project (click ğŸ“š Sample button)
2. ğŸ“Š View Story Graph
3. ğŸ–±ï¸ Click a node â†’ Try AI Checkup
4. ğŸ’¬ Ask questions in Chat (e.g., "How many characters?")
5. ğŸ”„ Edit and save your own project!
```

#### 5. å›¾è°± UX å¢å¼º
- ç»“å±€èŠ‚ç‚¹ç‰¹æ®Šé¢œè‰²ï¼ˆç»¿è‰²è¾¹æ¡†ï¼‰
- èµ·ç‚¹èŠ‚ç‚¹ç‰¹æ®Šæ ‡è®°ï¼ˆâ­ï¼‰
- æŒ‰ç« èŠ‚åˆ†åŒºæ˜¾ç¤ºï¼ˆæµ…è‰²èƒŒæ™¯æ¡†ï¼‰
- æŒ‰è§’è‰²è¿‡æ»¤èŠ‚ç‚¹

#### 6. å¯¼å‡ºæ ‡å‡†åŒ–
- å®šä¹‰ Story Graph Export v1.0 JSON Schema
- ç¼–å†™ `export_to_renpy.py` ç¤ºä¾‹è„šæœ¬
- å¯¼å‡º AI åˆ†æç»“æœä¸º Markdown Story Bible

---

### ä½ä¼˜å…ˆçº§ï¼ˆå·¥ç¨‹æ”¹è¿›ï¼‰

#### 7. è‡ªåŠ¨åŒ–æµ‹è¯•
```python
# tests/test_scene_checkup.py
def test_checkup_caching():
    checkup = SceneCheckup(ai_service)
    result1 = checkup.run_checkup(project, scene)
    result2 = checkup.run_checkup(project, scene)
    assert result2['cached'] == True
```

#### 8. é”™è¯¯è¯Šæ–­é¢æ¿
- æ˜¾ç¤ºå½“å‰ API é…ç½®çŠ¶æ€
- Token ä½¿ç”¨ç»Ÿè®¡
- å‘é‡åº“ç´¢å¼•çŠ¶æ€
- æœ€è¿‘é”™è¯¯æ—¥å¿—

#### 9. å¤šæ¨¡å‹é…ç½®æ–‡æ¡£
- å¦‚ä½•åˆ‡æ¢åˆ° OpenAI / Claude / å…¶ä»–
- LiteLLM é…ç½®ç¤ºä¾‹

---

## ğŸ“ å®ç°ç»Ÿè®¡

### æ–°å¢æ–‡ä»¶
- `src/ui/scene_checkup_panel.py` (209 è¡Œ)

### ä¿®æ”¹æ–‡ä»¶
- `src/ui/sidebar.py` (+22 è¡Œ)
- `src/ui/routes_view.py` (+50 è¡Œ)

### æ ¸å¿ƒåŠŸèƒ½
- âœ… ç¤ºä¾‹é¡¹ç›®ä¸€é”®åŠ è½½
- âœ… åœºæ™¯ä½“æ£€é¢æ¿ï¼ˆç¼“å­˜ + ç»“æ„åŒ–è¾“å‡º + å¯¼å‡ºï¼‰
- âœ… èŠ‚ç‚¹ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…
- â¸ï¸ è·¯å¾„è¯•ç©ï¼ˆå¾…å®ç°ï¼‰

### ç”¨æˆ·ä»·å€¼æå‡
- **é™ä½ä¸Šæ‰‹é—¨æ§›:** Sample æŒ‰é’® â†’ ç«‹å³çœ‹åˆ°æ•ˆæœ
- **æå‡åˆ†ææ•ˆç‡:** AI ä½“æ£€é¢æ¿ â†’ ä¸€é”®æŠ¥å‘Š + ç¼“å­˜
- **æ”¹å–„æ¢ç´¢ä½“éªŒ:** ç‚¹å‡»èŠ‚ç‚¹ â†’ ç«‹å³æŸ¥çœ‹å†…å®¹

---

## ğŸ‰ æ€»ç»“

é€šè¿‡è¿™3é¡¹ï¼ˆ2.5é¡¹ï¼‰æ”¹è¿›ï¼Œé¡¹ç›®å·²ç»ä»"æŠ€æœ¯ demo"è¿›åŒ–ä¸º**å¯ç”¨çš„åˆ›ä½œå·¥å…·**ï¼š

âœ… **æ–°ç”¨æˆ·å‹å¥½:** ä¸€é”®æ‰“å¼€ç¤ºä¾‹é¡¹ç›®  
âœ… **AI èƒ½åŠ›äº§å“åŒ–:** ä»èŠå¤© â†’ ç»“æ„åŒ–æŠ¥å‘Š  
âœ… **äº¤äº’ç›´è§‚:** ç‚¹å‡»æŸ¥çœ‹ï¼Œè€Œéæ‰‹åŠ¨æŸ¥æ‰¾  
ğŸ”„ **æ’­æ”¾ä½“éªŒ:** è·¯å¾„è¯•ç©åŠŸèƒ½è®¾è®¡å®Œæˆï¼Œå¾…å®ç°  

**ä¸‹ä¸€æ­¥æœ€é‡è¦çš„æ˜¯:**
1. å®ç°è·¯å¾„è¯•ç©åŠŸèƒ½ï¼ˆå®Œæˆ"æœ€å°3ä»¶äº‹"ï¼‰
2. å¾æ±‚çœŸå®ç”¨æˆ·åé¦ˆ
3. æ ¹æ®åé¦ˆè¿­ä»£å›¾è°± UX å’Œå¯¼å‡ºåŠŸèƒ½

---

**å®Œæˆæ—¶é—´:** 2025-12-30  
**ç‰ˆæœ¬:** v1.1 - Product Experience Enhancement
