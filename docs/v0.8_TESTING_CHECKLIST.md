# v0.8 Testing Checklist

## 测试日期：2026-01-11

### ✏️ Storylet Editor Testing

#### 基础功能测试
- [ ] **启动应用**
  - 运行 `streamlit run src/app.py`
  - 验证应用正常启动
  - 检查 Storylets 标签是否出现

- [ ] **Tab 导航**
  - 点击 Storylets 标签
  - 验证出现两个子标签：Library 和 Create New
  - 验证其他标签（Routes, Characters, Director 等）仍正常工作

#### 📚 Library 功能测试
- [ ] **加载示例项目**
  - 加载 `wuxia_rpg` 示例项目
  - 验证 Library 显示所有 storylets（应该显示6个）
  - 检查计数器是否正确

- [ ] **搜索功能**
  - 在搜索框输入 "市场"
  - 验证过滤后的结果只包含相关 storylets
  - 清空搜索，验证所有 storylets 重新显示
  - 测试 ID 搜索（如 "st-"）
  - 测试标签搜索（如 "冲突"）

- [ ] **筛选功能**
  - 选择 "Fallback" 筛选
    - 验证只显示 `is_fallback: true` 的 storylets
    - wuxia_rpg应显示2个（市井传闻、刻苦修炼）
  - 选择 "Once" 筛选
    - 验证只显示 `once: true` 的 storylets
    - wuxia_rpg应显示1个（师父传授武功）
  - 选择 "Has Cooldown" 筛选
    - 验证只显示 `cooldown > 0` 的 storylets
  - 选择 "Has Ordering" 筛选
    - 验证只显示有 `requires_fired` 或 `forbids_fired` 的 storylets
    - wuxia_rpg应显示2个（师父传授、神秘人物）
  - 选择 "All" 筛选
    - 验证显示所有 storylets

- [ ] **卡片显示**
  - 点击展开一个 storylet 卡片
  - 验证显示以下信息（无emoji）：
    - 标题和 ID
    - 属性徽章（[Fallback], [Once], [Cooldown: X], #tags）
    - 指标（Weight, Intensity Δ, Conditions, Effects）
    - 描述文本
    - 排序约束（如果有，使用 ▶ 和 ✕ 符号）
    - 可展开的条件列表
    - 可展开的效果列表

- [ ] **编辑功能**
  - 点击一个 storylet 的 ✏️ Edit 按钮
  - 验证切换到 "Create New" 标签
  - 验证表单已填充该 storylet 的数据
  - 验证 ID 字段被禁用（不可修改）

- [ ] **删除功能**
  - 点击一个 storylet 的 🗑️ Delete 按钮
  - 验证出现确认提示
  - 再次点击确认删除
  - 验证 storylet 从列表中移除
  - 验证项目文件已保存（刷新应用后不再出现）

#### ➕ Create New 功能测试
- [ ] **空表单验证**
  - 切换到 "Create New" 标签
  - 验证所有字段为空（或默认值）
  - 尝试直接保存（不填 ID 和标题）
  - 验证出现错误提示："ID and Title are required!"

- [ ] **基本信息**
  - 填写 ID: `test_storylet_01`
  - 填写标题: "测试故事块"
  - 填写描述: "这是一个测试用的故事块"
  - 验证所有字段正常输入

- [ ] **属性设置**
  - 设置 Weight: 0.8
  - 设置 Intensity Δ: 0.3
  - 设置 Cooldown: 5
  - 勾选 Once 复选框
  - 勾选 Fallback 复选框
  - 填写 Tags: "test, combat, action"
  - 验证所有设置正常

- [ ] **排序约束**
  - 填写 Requires Fired: "intro_01, setup_02"
  - 填写 Forbids Fired: "bad_end_01"
  - 验证输入正常

- [ ] **条件管理**
  - 点击 ➕ Add Condition
  - 验证出现新的条件表单
  - 设置第一个条件：
    - Scope: world
    - Target: world
    - Path: vars.power
    - Op: >=
    - Value: 50
  - 再次点击 ➕ Add Condition
  - 设置第二个条件：
    - Scope: character
    - Target: char-001
    - Path: mood
    - Op: ==
    - Value: 1
  - 点击第一个条件的 🗑️ Remove
  - 验证第一个条件被移除
  - 验证第二个条件仍然存在

- [ ] **效果管理**
  - 点击 ➕ Add Effect
  - 验证出现新的效果表单
  - 设置效果：
    - Scope: world
    - Target: world
    - Path: vars.power
    - Op: add
    - Value: 10
  - 点击 ➕ Add Effect 再添加一个
  - 设置第二个效果：
    - Scope: character
    - Target: char-001
    - Path: mood
    - Op: set
    - Value: 2
  - 验证两个效果都正确显示

- [ ] **保存功能**
  - 点击 💾 Save Storylet
  - 验证出现成功提示
  - 切换到 Library 标签
  - 验证新创建的 storylet 出现在列表中
  - 验证所有数据正确保存

- [ ] **重置功能**
  - 返回 Create New 标签
  - 随便填写一些字段
  - 点击 🔄 Reset Form
  - 验证所有字段被清空
  - 验证条件和效果列表被清空

- [ ] **编辑模式**
  - 从 Library 选择一个 storylet 并点击 Edit
  - 验证表单填充正确
  - 修改标题
  - 添加一个新条件
  - 点击 Save
  - 验证修改已保存
  - 返回 Library 验证修改生效

- [ ] **复制功能**
  - 编辑一个现有 storylet
  - 点击 📋 Duplicate
  - 验证出现提示："Change the ID to create a duplicate"
  - 修改 ID 为 `original_id_copy`
  - 点击 Save
  - 验证创建了新的副本
  - 验证原始 storylet 仍然存在

### 📖 示例项目测试

#### wuxia_rpg 项目
- [ ] **加载项目**
  - 在侧边栏找到 wuxia_rpg 示例
  - 加载项目
  - 验证项目正常加载

- [ ] **Storylets 验证**
  - 切换到 ✏️ Storylets 标签
  - 验证显示 15 个 storylets
  - 验证包含以下类型：
    - 武功修炼相关
    - 剧情推进相关
    - 关系发展相关
    - 结局触发相关
  - 验证排序约束正确（结局 storylets 有 forbids_fired）

- [ ] **World Director 测试**
  - 切换到 🎬 World Director 标签
  - 创建新线程或使用现有线程
  - 运行 3-5 个 ticks
  - 验证 storylets 正常触发
  - 验证排序约束生效（查看历史记录）
  - 验证状态变化正确应用

#### scifi_adventure 项目
- [ ] **加载项目**
  - 加载 scifi_adventure 示例
  - 验证项目正常加载

- [ ] **Storylets 验证**
  - 验证显示 25 个 storylets
  - 验证包含多条时间线的 storylets
  - 验证复杂排序约束（多个 requires_fired）

- [ ] **Editor 测试**
  - 使用 Editor 创建新的科幻主题 storylet
  - 保存并验证
  - 在 World Director 中测试新 storylet 是否触发

#### romance_sim 项目
- [ ] **加载项目**
  - 加载 romance_sim 示例
  - 验证项目正常加载

- [ ] **Storylets 验证**
  - 验证显示 19 个 storylets
  - 验证 3 条恋爱路线的 storylets
  - 验证互斥路线的 forbids_fired 正确

### 文档测试

- [ ] **GETTING_STARTED.en.md**
  - 打开文档
  - 验证有 Storylet Editor 章节
  - 验证说明清晰完整
  - 验证示例代码正确

- [ ] **GETTING_STARTED.zh.md**
  - 打开文档
  - 验证有 Storylet 编辑器章节
  - 验证中文翻译准确
  - 验证与英文版内容一致

- [ ] **README.md**
  - 验证 v0.8 标记为已完成
  - 验证列出了新功能（Storylet Editor）
  - 验证示例项目列表完整

### 代码质量检查

- [ ] **storylet_editor_view.py**
  - 模块级文档字符串完整
  - 所有函数有详细 docstring
  - 复杂逻辑有行内注释
  - 参数和返回值有说明
  - 有副作用的函数说明了 Side Effects

- [ ] **其他文件检查**
  - ai_service.py - 文档完整 ✓
  - storylet.py - 文档完整 ✓
  - layout.py - 集成正确 ✓

### 性能和稳定性测试

- [ ] **大量 Storylets**
  - 创建包含 50+ storylets 的项目
  - 验证搜索性能良好
  - 验证筛选响应快速
  - 验证卡片渲染流畅

- [ ] **边界情况**
  - 空项目（无 storylets）验证
  - 创建空条件列表的 storylet
  - 创建空效果列表的 storylet
  - 超长 ID、标题、描述的处理
  - 特殊字符在字段中的处理

- [ ] **错误处理**
  - 删除正在编辑的 storylet
  - 保存时项目文件权限问题
  - 无效的条件/效果值

### 双语支持测试

- [ ] **中文界面**
  - 在 Settings 切换到中文
  - 验证 Storylet Editor 标签翻译正确
  - 验证表单字段翻译正确
  - 验证错误提示为中文

- [ ] **英文界面**
  - 切换到英文
  - 验证所有文本为英文
  - 验证格式和布局正常

---

## 测试结果记录

**测试人员：** ___________  
**测试日期：** ___________  
**应用版本：** v0.8  

**发现的问题：**

1. 

2. 

3. 

**整体评价：**

- [ ] 所有核心功能正常
- [ ] 文档准确完整
- [ ] 代码注释详细
- [ ] 用户体验良好
- [ ] 性能表现优秀

**建议改进：**

1.

2.

3.

---

## 自动化测试建议

为未来版本考虑添加：

1. **单元测试**
   - `test_storylet_editor.py` - 测试编辑器逻辑
   - `test_storylet_filtering.py` - 测试搜索和筛选算法
   - `test_storylet_validation.py` - 测试表单验证

2. **集成测试**
   - 测试 Editor 与 World Director 的集成
   - 测试保存和加载流程
   - 测试多线程场景

3. **UI 测试**
   - Playwright/Selenium 自动化测试
   - 测试 Streamlit 组件交互
   - 截图回归测试

4. **性能测试**
   - 大量 storylets 加载时间
   - 搜索响应时间基准
   - 内存使用监控
