# 测试指南 / Testing Guide

## 📖 测试场景：赛博侦探 - 记忆碎片

一个赛博朋克风格的侦探悬疑故事，包含：
- ✅ 6个场景（含分支结构）
- ✅ 5个角色（含复杂关系网）
- ✅ 丰富的对话和世界观设定
- ✅ 适合测试所有AI功能的内容

---

## 🚀 如何开始测试

### 1. 启动应用

```bash
# 在项目根目录下
streamlit run src/app.py
```

### 2. 加载测试项目

1. 点击侧边栏的「📂 加载」按钮
2. 输入路径：`./examples/test_scenario/project.json`
3. 点击「加载」

---

## 📊 测试一：故事路线（Routes View）

### 测试目标
- 查看场景列表
- 理解场景关系和分支
- 测试场景的创建和删除（可选）

### 测试步骤

#### 1. 浏览场景列表
点击「📊 故事路线」标签，你会看到：

**场景 1：雨夜的委托**
- 开场场景
- 介绍主角陈墨和神秘女委托人
- 包含2个选择分支

**场景 2：意外的身份**
- 揭露神秘女人就是"死亡"的林雪薇
- 引出「永生计划」的核心冲突
- 展开调查路线

**场景 3：无法拒绝的理由**
- 如果玩家拒绝委托的替代路线
- 展示陈墨的过去（黑历史）
- 最终还是会汇合到主线

**场景 4-6：后续调查**
- 包含潜入、对话、战斗等不同类型场景
- 测试复杂的分支结构

#### 2. 查看场景图谱
滚动到底部，查看「📈 简易图谱」：
- **节点**：所有场景
- **连接**：场景之间的选择关系

#### 3. 测试场景详情
展开任意场景卡片：
- 查看场景ID
- 查看场景内容
- 查看分支选项（箭头指向目标场景）

#### 4. （可选）创建新场景
点击「➕ 新建场景」：
- 标题：`结局：真相大白`
- 内容：`你终于找到了所有的记忆碎片...`
- 章节：`第三章：结局`
- 测试创建功能

---

## 👥 测试二：角色管理（Characters View）

### 测试目标
- 查看角色档案
- 理解角色关系网络
- 测试角色的创建（可选）

### 测试步骤

#### 1. 浏览角色列表
点击「👥 角色管理」标签，你会看到5个角色：

**陈墨（主角）**
- 前军方特工，现为私家侦探
- 特征：冷静、谨慎、正义感强
- 目标：找出真相、保护无辜者
- 恐惧：再次失去战友、被系统背叛

**林雪薇（关键NPC）**
- "死而复生"的记忆工程师
- 特征：聪明、坚韧、神秘
- 目标：找回失去的记忆、阻止永生计划
- 与江一鸣有师徒关系

**神秘女人**
- 林雪薇的伪装身份
- 展示角色的多面性

**老李（线人）**
- 警局内部的老友
- 提供关键情报

**江一鸣（助手）**
- 年轻的研究助手
- 对林雪薇忠诚

#### 2. 查看角色详情
展开任意角色卡片：
- 查看完整描述
- 查看性格特征
- 查看目标和恐惧
- 查看人际关系（如有）

#### 3. 分析角色关系网
- 林雪薇 ← 导师关系 → 江一鸣
- 陈墨 ← 线人关系 → 老李
- 可以看到复杂的人物关系图

#### 4. （可选）创建新角色
点击「➕ 新建角色」：
- 名称：`赵军`
- 别名：`清洁者`
- 描述：`公司派来的杀手，负责清理知道太多秘密的人...`
- 测试创建功能

---

## 🤖 测试三：AI 工具（AI Tools View）

### 前提条件
⚠️ **确保已设置 DeepSeek API Key**

在项目根目录的 `.env` 文件中：
```
DEEPSEEK_API_KEY=your_api_key_here
```

### 测试 3.1：场景摘要生成

#### 测试步骤
1. 点击「🤖 AI 工具」标签
2. 选择工具：「场景摘要」
3. 选择场景：「雨夜的委托」（推荐用这个，内容丰富）
4. 点击「🚀 生成摘要」

#### 预期结果
AI 应该生成类似这样的摘要：
> "2077年的雨夜，私家侦探陈墨接待了一位神秘女委托人。她声称记忆被盗，需要找回关键信息。陈墨发现委托背后隐藏着军方级别的秘密。"

#### 测试要点
- ✅ 摘要是否准确概括了场景内容
- ✅ 摘要是否简洁（2-3句话）
- ✅ Token 统计是否正常更新

---

### 测试 3.2：世界观设定提取

#### 测试步骤
1. 选择工具：「设定提取」
2. 选择场景：「意外的身份」（这个场景信息量最大）
3. 点击「🚀 提取设定」

#### 预期结果
AI 应该提取出类似这些设定：
- [角色] 林雪薇是「合成未来」公司的首席记忆工程师
- [世界观] 存在「永生计划」的秘密研究项目
- [剧情] 林雪薇在三个月前被宣布死亡，但实际幸存
- [技术] 存在可以篡改人类记忆的脑机接口技术
- [冲突] 军方介入并下令不得调查此案

#### 测试要点
- ✅ 是否提取出关键设定
- ✅ 是否区分了角色、世界观、剧情等类型
- ✅ 提取的内容是否准确

---

### 测试 3.3：OOC 检测（重点测试）

这是最有趣的测试！我们来检测角色是否"演技在线"。

#### 测试案例 1：符合人设的行为

**步骤：**
1. 选择工具：「OOC 检测」
2. 选择角色：「陈墨」
3. 选择场景：「雨夜的委托」
4. 点击「🚀 检测 OOC」

**预期结果：**
- ✅ 角色行为符合人设
- 分析：陈墨表现出谨慎、专业的侦探特质，符合"冷静、谨慎"的性格标签

#### 测试案例 2：可能OOC的对比

**步骤：**
1. 选择角色：「江一鸣」（年轻、热情、冲动）
2. 选择场景：「雨夜的委托」（这个场景里没有江一鸣）
3. 点击「🚀 检测 OOC」

**预期结果：**
- ⚠️ 可能检测到问题（因为场景中没有这个角色的表现）

#### 测试案例 3：性格一致性

**步骤：**
1. 选择角色：「林雪薇」
2. 选择场景：「意外的身份」
3. 查看她在场景中的表现：冷静分析、揭露真相
4. 对比角色档案：聪明、坚韧、执着

**预期结果：**
- ✅ 高度一致
- AI 应该指出她的行为符合"聪明"和"坚韧"的特质

---

## 🎯 高级测试：完整工作流

### 测试场景：创作一个新结局

1. **在路线视图**：创建新场景「终极对决」
2. **在角色管理**：查看所有角色关系，确定谁会出现在结局
3. **用AI生成**：为新场景生成摘要
4. **用AI提取**：从新场景中提取关键设定
5. **用AI检测**：确保主角在结局中的行为符合人设

---

## 🐛 常见问题

### Q1: AI 调用失败
**A:** 检查 `.env` 文件中的 API Key 是否正确

### Q2: 中英文切换不正常
**A:** 在侧边栏下方的语言选择器切换后，页面会自动刷新

### Q3: 场景图谱显示不完整
**A:** 当前版本使用简易文本图谱，后续版本会升级为可视化图形

### Q4: Token 消耗过快
**A:** 
- 每次 AI 调用大约消耗 300-800 tokens
- 项目默认限制是 50,000 tokens
- 可以在项目设置中调整

---

## 📈 测试检查清单

完成以下测试项：

### 基础功能
- [ ] 成功加载测试项目
- [ ] 查看所有6个场景
- [ ] 查看所有5个角色
- [ ] 切换中英文界面

### 路线视图
- [ ] 浏览场景列表
- [ ] 展开场景查看详情
- [ ] 查看分支选项
- [ ] 查看简易图谱
- [ ] （可选）创建新场景

### 角色管理
- [ ] 浏览角色列表
- [ ] 查看角色完整档案
- [ ] 查看角色关系
- [ ] （可选）创建新角色

### AI 工具
- [ ] 生成场景摘要
- [ ] 提取世界观设定
- [ ] 检测角色OOC（至少2个场景）
- [ ] 查看Token使用统计

### 高级测试
- [ ] 完成完整工作流（创作→生成→检测）
- [ ] 测试多语言切换后AI功能是否正常
- [ ] 测试保存项目功能

---

## 💡 测试建议

### 最佳测试顺序
1. **先熟悉内容**：花5分钟阅读所有场景和角色
2. **再测试AI**：这样你能判断AI生成的内容是否准确
3. **最后创作**：尝试添加你自己的场景和角色

### 重点测试项
1. **OOC检测的准确性** - 这是最核心的AI功能
2. **设定提取的完整性** - 能否抓住关键信息
3. **多语言界面** - 确保中英文都能正常工作

### 发现问题后
- 记录问题场景和操作步骤
- 检查控制台是否有错误信息
- 查看Token统计是否异常

---

## 🎉 测试完成后

你应该能够：
- ✅ 理解如何管理复杂的分支故事
- ✅ 使用AI工具辅助创作
- ✅ 检测角色一致性
- ✅ 快速生成场景摘要和设定文档

**下一步**：开始创作你自己的故事吧！🚀

---

**祝测试愉快！有问题随时反馈。**
