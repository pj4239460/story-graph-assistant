# AI条件测试指南 - 江湖风云
## 中文测试用例 | 2026-01-13

---

## 📖 项目简介

**项目名称：** 江湖风云 - AI条件测试  
**位置：** `examples/ai_test_zh/project.json`  
**语言：** 中文  
**目的：** 测试v0.9版本的AI自然语言条件功能

### 背景设定
你是一名刚下山的年轻侠客，来到云州城。城中三大势力：
- **青云门**（正派）- 李青云掌门，侠义为怀
- **血影堂**（邪派）- 血无痕堂主，心狠手辣
- **商盟会**（中立）- 王富贵会长，富甲一方

### 世界状态变量
```
qingyun_power: 70      # 青云门势力（正派）
xueying_power: 50      # 血影堂势力（邪派）
shanglian_power: 60    # 商盟会势力（中立）
peace_level: 65        # 江湖和平度
public_mood: 55        # 民心/百姓情绪
player_reputation: 30  # 玩家名声
player_wealth: 40      # 玩家财富
```

---

## 🎯 快速测试步骤

### 1. 加载项目
1. 打开 http://localhost:8501
2. 侧边栏加载项目
3. 选择 `examples/ai_test_zh/project.json`

### 2. 创建Story Thread
1. 点击 **📊 Routes** 标签
2. 找到场景 **"初入江湖"**
3. 点击场景，选择 **Play Path** 或 **Execute**
4. 世界状态初始化完成

### 3. 查看AI模式选择器
1. 切换到 **🎬 World Director** 标签
2. 现在应该能看到 **🎯 导演模式** 选择器：
   - 🔧 确定性（基于规则）
   - 🤖 AI辅助（混合）
   - 🧠 AI主导（涌现）

### 4. 测试三种模式
**先测试确定性模式（基准）：**
- 选择 "🔧 确定性"
- 点击 "Run Tick" 5次
- 观察：只有传统storylets触发（如"青云门招募"）

**测试AI辅助模式（重点）：**
- 选择 "🤖 AI辅助"
- 点击 "Run Tick" 10次
- 观察：NL条件storylets可能触发（如"太平盛世"）

**测试AI主导模式：**
- 选择 "🧠 AI主导"
- 点击 "Run Tick" 5次
- 观察token消耗和响应时间

---

## 🧪 10个NL条件Storylets测试

### 1. 商界大佬的邀请 (`st-nl-wealthy-reputation`)
**NL条件：** "玩家看起来富有并且在江湖中有一定名声"

**如何触发：**
- 设置 `player_wealth` = 60+
- 设置 `player_reputation` = 50+

**测试点：**
- AI能判断"看起来富有"（不只是数值）
- "一定名声"的模糊量词理解

**预期：** 财富和名声都较高时触发

---

### 2. 山雨欲来 (`st-nl-tense-atmosphere`)
**NL条件：** "江湖气氛非常紧张，正邪双方势力都很强且关系恶劣"

**如何触发：**
- `qingyun_power` = 70+（正派强）
- `xueying_power` = 60+（邪派强）
- `peace_level` = 40-50（关系恶劣）

**测试点：**
- AI综合评估"紧张气氛"
- 理解"双方都强"的对称条件
- 判断"关系恶劣"

**预期：** 正邪对立激烈时触发

---

### 3. 李青云的私密托付 (`st-nl-trust-despite-conflict`)
**NL条件：** "李青云信任玩家，尽管最近江湖中有冲突和矛盾"

**如何触发：**
- `player_reputation` = 45+（有一定名声）
- `peace_level` = 50-65（有冲突但不极端）

**测试点：**
- AI理解"尽管...但是"的逻辑关系
- 情感判断（信任）
- 复杂关系推理

**预期：** 玩家有声望且江湖有冲突时触发

---

### 4. 太平盛世 (`st-nl-peaceful-prosperity`)
**NL条件：** "江湖和平，各方势力没有严重冲突，百姓生活安稳"

**如何触发：**
- `peace_level` = 75+
- `public_mood` = 70+
- 各方势力差距不太大

**测试点：**
- AI整体评估多个维度
- "没有严重冲突"的否定条件
- "安稳"的质性判断

**预期：** 和平繁荣时期触发

---

### 5. 民不聊生 (`st-nl-desperate-people`)
**NL条件：** "百姓生活艰难，民心不稳，对现状感到绝望"

**如何触发：**
- `public_mood` = 30以下
- `peace_level` = 40以下

**测试点：**
- AI识别"绝望"情绪
- "民心不稳"的社会状态
- 多维度负面评估

**预期：** 民生凋敝时触发

---

### 6. 三足鼎立 (`st-nl-power-balance`)
**NL条件：** "三大势力的力量大致相当，形成微妙的平衡"

**如何触发：**
- `qingyun_power` ≈ 55
- `xueying_power` ≈ 53
- `shanglian_power` ≈ 57
（差距在5以内）

**测试点：**
- AI理解"大致相当"的模糊概念
- 不是精确相等
- 三方平衡判断

**预期：** 三方势力接近时触发

---

### 7. 邪派猖獗 (`st-nl-evil-dominating`)
**NL条件：** "邪派势力过于强大，并且行事肆无忌惮地欺压百姓"

**如何触发：**
- `xueying_power` = 70+
- `qingyun_power` < 55
- `public_mood` = 40以下

**测试点：**
- "过于强大"的相对判断
- "肆无忌惮"的行为模式推断
- 因果关系（强大→欺压→民怨）

**预期：** 邪派压倒性优势且民怨时触发

---

### 8. 武林大会召开 (`st-nl-martial-tournament`)
**NL条件：** "江湖中有重要事件需要各方坐下来商议"

**如何触发：**
- `peace_level` = 50-70（不太高不太低）
- 势力有较大变化或冲突升级

**测试点：**
- AI判断是否有"重要事件"（元叙事）
- "需要商议"的情境识别
- 时机判断

**预期：** 局势复杂需要对话时触发

---

### 9. 少侠崭露头角 (`st-nl-young-hero-rising`)
**NL条件：** "玩家在江湖中逐渐有了一些名气和影响力"

**如何触发：**
- `player_reputation` = 40-60（从低到中）
- 玩家有"初入江湖"特质

**测试点：**
- AI理解"逐渐"的渐进性
- "一些"的模糊量词
- 成长轨迹判断

**预期：** 玩家名气从无到有的过程中触发（once=true，只触发一次）

---

### 10. 大战将至 (`st-nl-crisis-imminent`)
**NL条件：** "局势极度紧张，正邪大战似乎即将爆发"

**如何触发：**
- `peace_level` = 30以下
- `qingyun_power` 和 `xueying_power` 都较高
- `public_mood` = 35以下

**测试点：**
- AI理解"即将"的时间性
- "似乎"的不确定性
- 预测性判断

**预期：** 冲突达到临界点时触发

---

## 📊 推荐测试流程

### 测试场景A：和平→冲突→危机
1. **初始状态**（和平）
   - Run Tick 3次，观察是否触发"太平盛世"
   
2. **制造冲突**
   - 手动调整：`xueying_power` = 65, `peace_level` = 50
   - Run Tick，观察"山雨欲来"
   
3. **升级危机**
   - 调整：`peace_level` = 25, `public_mood` = 28
   - Run Tick，观察"大战将至"或"民不聊生"

### 测试场景B：势力平衡演变
1. **平衡状态**
   - 设置三方势力都在52-58之间
   - Run Tick，观察"三足鼎立"
   
2. **邪派崛起**
   - `xueying_power` = 75, `qingyun_power` = 50
   - Run Tick，观察"邪派猖獗"

### 测试场景C：玩家成长
1. **初始新人**
   - `player_reputation` = 30
   - Run Tick多次
   
2. **逐渐出名**
   - `player_reputation` = 50
   - 触发"少侠崭露头角"（只触发一次）
   
3. **获得机遇**
   - `player_wealth` = 60, `player_reputation` = 55
   - 触发"商界大佬的邀请"

---

## ✅ 测试检查清单

### 基础功能
- [ ] 项目成功加载
- [ ] 初始场景正确执行
- [ ] 世界状态正确初始化
- [ ] AI模式选择器显示正常（3个选项）

### 确定性模式
- [ ] 只触发传统storylets（无st-nl-*）
- [ ] 响应速度快（<1秒）
- [ ] Token消耗为0

### AI辅助模式
- [ ] 传统和NL storylets都能触发
- [ ] 至少触发2-3个NL storylets
- [ ] 显示AI评估推理
- [ ] Token消耗200-800/次
- [ ] 响应时间~500ms-1s

### 缓存机制
- [ ] 相同状态第二次评估token为0
- [ ] 缓存命中时响应很快

### 具体NL条件
- [ ] "太平盛世"在和平时触发
- [ ] "民不聊生"在危机时触发
- [ ] "三足鼎立"在平衡时触发
- [ ] "邪派猖獗"在邪派强大时触发
- [ ] "大战将至"在极度紧张时触发

### AI理解能力
- [ ] 理解模糊量词（"一些"、"大致"）
- [ ] 理解复杂逻辑（"尽管...但是"）
- [ ] 理解情绪状态（"绝望"、"紧张"）
- [ ] 理解行为模式（"肆无忌惮"）
- [ ] 理解时间性（"逐渐"、"即将"）

---

## 🐛 常见问题

**Q: NL storylets不触发？**
- 检查是否在AI-Assisted或AI-Primary模式
- 检查世界状态是否符合条件
- 查看日志中的AI评估推理

**Q: Token消耗过高？**
- 正常范围：200-800/次NL评估
- 如果超过2000，检查是否AI-Primary模式
- 使用缓存减少重复评估

**Q: 响应很慢？**
- AI-Assisted: 500ms-1s正常
- AI-Primary: 1-2s正常
- 如果超过5s，检查网络或API配置

**Q: 看不到AI推理？**
- 查看Tick History或日志区域
- 某些UI可能需要展开详情
- 检查是否有输出到控制台

---

## 📝 测试记录模板

```
测试日期：2026-01-13
测试项目：江湖风云
AI模式：AI辅助

场景1：和平时期
- 状态：peace=75, mood=70
- 触发：太平盛世 ✓
- Token：420
- 推理：___________

场景2：危机时期
- 状态：peace=28, mood=30
- 触发：大战将至 ✓
- Token：580
- 推理：___________

总结：
- 成功率：__/10
- 问题：___________
```

---

## 🎯 成功标准

测试通过条件：
1. ✅ 10个NL storylets中至少7个能正确触发
2. ✅ AI推理逻辑合理（不是随机判断）
3. ✅ Token消耗在合理范围（<1000/tick）
4. ✅ 响应时间可接受（<3秒）
5. ✅ 缓存机制工作正常
6. ✅ 没有崩溃或严重错误

---

**祝测试顺利！有问题随时反馈。🚀**
